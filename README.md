# anuramat/nixos

## Install

```bash
git clone --depth 1 -- git@github.com:anuramat/nixos
sudo rm -rf /etc/nixos
sudo mv -T nixos /etc/nixos
# if the module is not in the repo yet, regenerate a hw cfg:
# > nixos-generate-config
# and use it in the new module in ./nix/machines/$hostname
make
# if the hostname doesn't match the machine:
# > sudo nixos-rebuild switch --flake /etc/nixos#$hostname
# make links
wallust theme random # some configs are generated by wallust wrapper
```

### Post

```bash
nvim # fetch plugins, install TS parsers
ssh-keygen # then add the public key to `user.nix`
gh auth login # github cli
git remote set-url origin git@github.com:anuramat/nixos # switch to ssh
sudo tailscale up "--operator=$(whoami)" # set up tailscale
# etc: proton pass, web browser, cache, telegram, spotify
```

#### Setting up nix-serve

```bash
# arbitrary, used in `services.nix-serve.secretKeyFile`
cd /var
sudo nix-store --generate-binary-cache-key $(hostname) cache.pem cache.pem.pub
sudo chown nix-serve cache-priv-key.pem
sudo chmod 400 cache.pem
sudo chmod 444 cache.pem.pub
# (hostname, public key) -> nix trusted substituters TODO maybe move to user.nix
# (path to the private key) -> machine config
```

## Structure

- `bin:config:home` - linked to appropriate directories
- `./nix/` - flake dependencies
- `./scripts` - makefile scripts

## Problems

### Hardcoded variables

- Personal data (`nixos/user.nix`, `rg -i 'anuramat|arsen'`, maybe `.bashrc`)
- todo.sh, ~/notes
- XDG basedir spec - `rg XDGBDSV`
- wmenu books in sway config searches for files in ~/books
